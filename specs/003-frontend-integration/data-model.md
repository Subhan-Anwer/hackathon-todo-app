# Data Model: Frontend UI & Full-Stack Integration

**Feature**: 003-frontend-integration
**Date**: 2026-01-30
**Phase**: Phase 1 - Design

## Overview

This document defines the **frontend TypeScript interfaces** for the Todo application. These are NOT database models—they represent the shape of data as consumed by the frontend from REST API responses. All data persistence is handled by the backend; the frontend works exclusively with these TypeScript types for type safety and IntelliSense support.

**Key Principle**: Frontend types mirror backend API response schemas. Any mismatch between frontend types and backend responses will cause runtime errors.

---

## Core Entities

### 1. Task

Represents a single task item in the todo list.

**Location**: `frontend/lib/types/task.ts`

```typescript
/**
 * Task entity - mirrors backend Task model
 * All fields match the API response from GET /api/v1/tasks
 */
export interface Task {
  /**
   * Unique identifier for the task (UUID)
   * Generated by backend on creation
   */
  id: string;

  /**
   * ID of the user who owns this task (UUID or TEXT)
   * Always matches the authenticated user's ID
   * Backend enforces this via JWT token validation
   */
  user_id: string;

  /**
   * Task title (required)
   * Max length: 255 characters (backend validation)
   * Cannot be empty or whitespace-only
   */
  title: string;

  /**
   * Task description (optional)
   * Can be null or empty string
   * No max length enforced
   */
  description: string | null;

  /**
   * Task completion status
   * - false: Task is pending/active
   * - true: Task is completed
   */
  completed: boolean;

  /**
   * Timestamp when task was created (ISO 8601 format)
   * Example: "2026-01-30T14:30:00.000Z"
   * Set by backend on creation, immutable
   */
  created_at: string;

  /**
   * Timestamp when task was last updated (ISO 8601 format)
   * Example: "2026-01-30T15:45:00.000Z"
   * Updated by backend on every modification
   */
  updated_at: string;
}
```

**Usage Examples**:
```typescript
// Type-safe task rendering
function TaskCard({ task }: { task: Task }) {
  const createdDate = new Date(task.created_at);
  return <div>{task.title}</div>;
}

// Type-safe API response
const tasks: Task[] = await apiClient.get<Task[]>("/api/v1/tasks");
```

**Validation Rules**:
- `id`: Must be non-empty string (backend-generated)
- `user_id`: Must be non-empty string (backend-enforced)
- `title`: Must be non-empty, trimmed string
- `description`: Can be null or string
- `completed`: Boolean only
- `created_at`, `updated_at`: ISO 8601 timestamp strings

---

### 2. TaskCreate

Request payload for creating a new task.

**Location**: `frontend/lib/types/task.ts`

```typescript
/**
 * Task creation payload - matches POST /api/v1/tasks request body
 * Only includes fields that the user provides
 * Backend auto-generates: id, user_id, completed, created_at, updated_at
 */
export interface TaskCreate {
  /**
   * Task title (required)
   * Frontend validation:
   * - Cannot be empty or whitespace-only
   * - Max length: 255 characters
   */
  title: string;

  /**
   * Task description (optional)
   * Frontend validation:
   * - Can be empty string or omitted
   * - No max length
   */
  description?: string;
}
```

**Usage Example**:
```typescript
// Form submission
const newTask: TaskCreate = {
  title: form.values.title.trim(),
  description: form.values.description || undefined,
};

const createdTask = await taskApi.create(newTask);
```

---

### 3. TaskUpdate

Request payload for updating an existing task.

**Location**: `frontend/lib/types/task.ts`

```typescript
/**
 * Task update payload - matches PUT /api/v1/tasks/{id} request body
 * All fields are optional (partial update)
 * Backend validates ownership before allowing update
 */
export interface TaskUpdate {
  /**
   * Updated task title (optional)
   * If provided, cannot be empty or whitespace-only
   */
  title?: string;

  /**
   * Updated task description (optional)
   * Can be set to null to clear description
   */
  description?: string | null;

  /**
   * Updated completion status (optional)
   * Usually updated via PATCH /api/v1/tasks/{id}/complete endpoint instead
   */
  completed?: boolean;
}
```

**Usage Example**:
```typescript
// Update only title
const update: TaskUpdate = { title: "New title" };
await taskApi.update(taskId, update);

// Update multiple fields
const update: TaskUpdate = {
  title: "Updated title",
  description: "Updated description",
  completed: true,
};
await taskApi.update(taskId, update);
```

---

## Authentication Entities

### 4. User

Represents an authenticated user.

**Location**: `frontend/lib/types/user.ts`

```typescript
/**
 * User entity - represents authenticated user from Better Auth
 * Derived from JWT token claims and Better Auth session
 */
export interface User {
  /**
   * Unique identifier for the user (UUID or TEXT)
   * Matches user_id in JWT token claims
   * Used to filter tasks by ownership
   */
  user_id: string;

  /**
   * User's email address
   * Used for sign-in and identification
   */
  email: string;

  /**
   * User's display name (optional)
   * Can be null if not provided during signup
   */
  name?: string | null;

  /**
   * Timestamp when user account was created (ISO 8601 format)
   * Optional field, may not be included in all auth responses
   */
  created_at?: string;
}
```

**Usage Example**:
```typescript
// Auth hook usage
const { user, isAuthenticated } = useAuth();

if (isAuthenticated && user) {
  console.log(`Logged in as ${user.email}`);
}
```

---

### 5. AuthCredentials

Request payload for user authentication.

**Location**: `frontend/lib/types/auth.ts`

```typescript
/**
 * Authentication credentials - matches POST /api/auth/signin request body
 */
export interface AuthCredentials {
  /**
   * User's email address
   * Frontend validation: Must be valid email format
   */
  email: string;

  /**
   * User's password
   * Frontend validation:
   * - Min length: 8 characters
   * - No max length enforced on frontend (backend handles)
   */
  password: string;
}
```

---

### 6. SignUpData

Request payload for user registration.

**Location**: `frontend/lib/types/auth.ts`

```typescript
/**
 * Sign-up data - matches POST /api/auth/signup request body
 */
export interface SignUpData {
  /**
   * User's email address
   * Frontend validation: Must be valid email format
   */
  email: string;

  /**
   * User's password
   * Frontend validation:
   * - Min length: 8 characters
   * - Should include mix of letters, numbers, symbols (recommended but not enforced on frontend)
   */
  password: string;

  /**
   * Password confirmation
   * Frontend validation: Must match password field
   * Not sent to backend (only used for frontend validation)
   */
  passwordConfirm: string;

  /**
   * User's display name (optional)
   * Can be omitted or empty string
   */
  name?: string;
}
```

---

## API Response Wrappers

### 7. ApiResponse<T>

Generic wrapper for backend API responses.

**Location**: `frontend/lib/types/api.ts`

```typescript
/**
 * Standardized API response wrapper
 * All backend endpoints return this structure for consistency
 */
export interface ApiResponse<T> {
  /**
   * Indicates if request was successful
   * - true: Request succeeded, data is available
   * - false: Request failed, error is available
   */
  success: boolean;

  /**
   * Response data (only present when success is true)
   * Type varies based on endpoint (generic T)
   */
  data?: T;

  /**
   * Error details (only present when success is false)
   */
  error?: ApiError;
}

/**
 * API error structure
 */
export interface ApiError {
  /**
   * Human-readable error message
   * Should be displayed to user
   */
  message: string;

  /**
   * Machine-readable error code
   * Examples: "UNAUTHORIZED", "NOT_FOUND", "VALIDATION_ERROR"
   */
  code: string;

  /**
   * Additional error details (optional)
   * May include field-specific validation errors
   */
  details?: Record<string, string>;
}
```

**Usage Example**:
```typescript
// Success response
const response: ApiResponse<Task> = {
  success: true,
  data: { id: "123", title: "Task 1", ... },
};

// Error response
const response: ApiResponse<Task> = {
  success: false,
  error: {
    message: "Task not found",
    code: "NOT_FOUND",
  },
};
```

**Note**: The API client (`lib/api/client.ts`) unwraps these responses and throws errors for failed requests, so components typically work with the `data` directly, not the wrapper.

---

## Form State Types

### 8. FormState<T>

Generic form state management type.

**Location**: `frontend/lib/types/forms.ts`

```typescript
/**
 * Form state for controlled form components
 * Generic T represents the shape of form values
 */
export interface FormState<T> {
  /**
   * Current form field values
   * Keys match form field names
   */
  values: T;

  /**
   * Validation errors per field
   * Keys match form field names, values are error messages
   * Empty object means no errors
   */
  errors: Partial<Record<keyof T, string>>;

  /**
   * Indicates if form is currently submitting
   * Used to disable submit button and show loading state
   */
  isSubmitting: boolean;

  /**
   * Indicates if form has been modified from initial values
   * Used to warn user about unsaved changes
   */
  isDirty: boolean;

  /**
   * Indicates if form has been touched (user interacted with any field)
   * Used to control when to show validation errors
   */
  isTouched?: boolean;
}
```

**Usage Example**:
```typescript
// Task creation form state
const formState: FormState<TaskCreate> = {
  values: { title: "", description: "" },
  errors: {},
  isSubmitting: false,
  isDirty: false,
};

// With validation errors
const formState: FormState<TaskCreate> = {
  values: { title: "", description: "" },
  errors: { title: "Title is required" },
  isSubmitting: false,
  isDirty: true,
};
```

---

## UI State Types

### 9. LoadingState

Represents loading state for async operations.

**Location**: `frontend/lib/types/ui.ts`

```typescript
/**
 * Loading state indicator
 */
export type LoadingState = "idle" | "loading" | "success" | "error";

/**
 * Async operation state with data and error
 */
export interface AsyncState<T> {
  /**
   * Current loading state
   */
  status: LoadingState;

  /**
   * Data from async operation (available when status is "success")
   */
  data: T | null;

  /**
   * Error from async operation (available when status is "error")
   */
  error: Error | null;
}
```

**Usage Example**:
```typescript
// Initial state
const state: AsyncState<Task[]> = {
  status: "idle",
  data: null,
  error: null,
};

// Loading
const state: AsyncState<Task[]> = {
  status: "loading",
  data: null,
  error: null,
};

// Success
const state: AsyncState<Task[]> = {
  status: "success",
  data: [{ id: "1", title: "Task 1", ... }],
  error: null,
};

// Error
const state: AsyncState<Task[]> = {
  status: "error",
  data: null,
  error: new Error("Failed to fetch tasks"),
};
```

---

## Relationships

### Task → User (Many-to-One)

- Each `Task` has exactly one `user_id` (owner)
- Each `User` can have zero or many `Task` instances
- Relationship is enforced by backend via foreign key constraint
- Frontend never modifies `user_id` (backend sets it from JWT)

**Diagram**:
```
User (1) ──── has many ──── (*) Task
 │                              │
 ├─ user_id                     ├─ id
 ├─ email                       ├─ user_id (FK to User.user_id)
 └─ name                        ├─ title
                                ├─ description
                                ├─ completed
                                ├─ created_at
                                └─ updated_at
```

---

## Validation Rules Summary

### Frontend Validation (Client-Side)

**TaskCreate**:
- `title`: Required, non-empty after trim, max 255 chars
- `description`: Optional, no max length

**TaskUpdate**:
- `title`: If provided, non-empty after trim, max 255 chars
- `description`: Optional, can be null
- `completed`: Optional, boolean

**AuthCredentials**:
- `email`: Required, valid email format
- `password`: Required, min 8 chars

**SignUpData**:
- `email`: Required, valid email format
- `password`: Required, min 8 chars
- `passwordConfirm`: Required, must match password
- `name`: Optional, no validation

### Backend Validation (Server-Side)

Backend performs ALL security-critical validations:
- User ownership verification (JWT-based)
- Data integrity constraints
- SQL injection prevention
- Input sanitization
- Business logic validation

**Frontend validation is for UX only—backend is the source of truth.**

---

## Type Organization

All TypeScript types are organized in `frontend/lib/types/`:

```
frontend/lib/types/
├── task.ts      # Task, TaskCreate, TaskUpdate
├── user.ts      # User
├── auth.ts      # AuthCredentials, SignUpData
├── api.ts       # ApiResponse, ApiError
├── forms.ts     # FormState
└── ui.ts        # LoadingState, AsyncState
```

Each file exports related types and includes JSDoc comments for IntelliSense support.

---

## Migration Notes

If backend API response schema changes:
1. Update corresponding TypeScript interface in `lib/types/`
2. Update API client functions in `lib/api/`
3. Update components that consume the type
4. Run TypeScript compiler to catch breaking changes
5. Update tests to match new schema

**Example Migration**:
```typescript
// Before: Task has "status" field
interface Task {
  status: "pending" | "completed";
}

// After: Task uses "completed" boolean
interface Task {
  completed: boolean;
}

// Update components:
// Before: task.status === "completed"
// After: task.completed
```

---

## Summary

- **10 core types** defined for frontend data modeling
- All types mirror backend API response schemas
- TypeScript provides compile-time type safety
- JSDoc comments improve developer experience
- Frontend validation is UX-focused, backend validation is security-focused
- Clear separation between entities, request payloads, and UI state

These types form the foundation for all data interactions in the frontend application.
